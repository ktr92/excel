!function(){"use strict";var t=function(){function t(t){this.$el="string"==typeof t?document.querySelector(t):t}return t.prototype.html=function(t){return"string"==typeof t?(this.$el.innerHTML=t,this):this.$el.outerHTML.trim()},t.prototype.text=function(t){return"string"==typeof t?(this.$el.textContent=t,this):"input"===this.$el.tagName.toLocaleLowerCase()?this.$el.value.trim():this.$el.textContent.trim()},t.prototype.clear=function(){return this.html(""),this},t.prototype.on=function(t,n){this.$el.addEventListener(t,n)},t.prototype.off=function(t,n){this.$el.removeEventListener(t,n)},t.prototype.append=function(n){return n instanceof t&&(n=n.$el),this.$el.append(n),this},t.prototype.closest=function(t){return n(this.$el.closest(t))},t.prototype.getCoords=function(){return this.$el.getBoundingClientRect()},t.prototype.findAll=function(t){return this.$el.querySelectorAll(t)},t.prototype.find=function(t){return n(this.$el.querySelector(t))},t.prototype.css=function(t){var n=this;Object.keys(t).forEach((function(e){return n.$el.style[e]=t[e]}))},t.prototype.addClass=function(t){this.$el.classList.add(t)},t.prototype.removeClass=function(t){this.$el.classList.remove(t)},t.prototype.id=function(){return this.$el.dataset.id},t.prototype.focus=function(){return this.$el.focus(),this},t.prototype.idCell=function(){var t=this.id().split(":");return{row:+t[0],col:+t[1]}},Object.defineProperty(t.prototype,"data",{get:function(){return this.$el.dataset},enumerable:!1,configurable:!0}),t}();function n(n){return new t(n)}n.create=function(t,e){void 0===e&&(e="");var o=document.createElement(t);return e&&o.classList.add(e),n(o)};var e=function(){function t(){this.listeners={}}return t.prototype.emit=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];return!!Array.isArray(this.listeners[t])&&(this.listeners[t].forEach((function(t){t.apply(void 0,n)})),!0)},t.prototype.subscribe=function(t,n){var e=this;return this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(n),function(){e.listeners[t]=e.listeners[t].filter((function(t){return t!=n}))}},t}(),o=function(){function t(t,o){this.selector=t,this.options=o,this.className="excel",this.$el=n(t),this.components=o.components||[],this.emitter=new e}return t.prototype.getRoot=function(){var t=n.create("div","excel"),e={emitter:this.emitter};return this.instances=this.components.map((function(o){var r=n.create("div",o.className),i=new o(r,e);return r.html(i.toHTML()),t.append(r),i})),t},t.prototype.render=function(){this.$el.append(this.getRoot()),this.instances.forEach((function(t){return t.init()})),console.log(this.instances)},t.prototype.destroy=function(){this.instances.forEach((function(t){return t.destroy()}))},t}();function r(t,n){var e;return n<t&&(t=(e=[n,t])[0],n=e[1]),new Array(n-t+1).fill("").map((function(n,e){return t+e}))}var i,s=function(){function t(t,n){if(this.$root=t,this.listeners=n,!t)throw new Error("No $root provided for DomListenter")}return t.prototype.initDOMListeners=function(){var t=this;this.listeners.forEach((function(n){var e=t.getMethodName(n);if(!t[e]){var o=t.name||"";throw new Error("Method ".concat(e," is not implemented in ").concat(o," Component"))}t[e]=t[e].bind(t),t.$root.on(n,t[e])}))},t.prototype.removeDOMListeners=function(){var t=this;this.listeners.forEach((function(n){var e=t.getMethodName(n);t.$root.off(n,t[e])}))},t.prototype.getMethodName=function(t){return"on"+("string"!=typeof(n=t)?"":n.charAt(0).toUpperCase()+n.slice(1));var n},t}(),c=(i=function(t,n){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},i(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}i(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),a=function(t,n,e){if(e||2===arguments.length)for(var o,r=0,i=n.length;r<i;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return t.concat(o||Array.prototype.slice.call(n))},u=function(t){function n(n,e){var o=t.call(this,n,e.listeners)||this;return o.emitter=e.emitter,o.unsubs=[],o.prepare(),o}return c(n,t),n.prototype.prepare=function(){},n.prototype.toHTML=function(){return""},n.prototype.init=function(){this.initDOMListeners()},n.prototype.$emit=function(t){for(var n,e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];(n=this.emitter).emit.apply(n,a([t],e,!1))},n.prototype.$on=function(t,n){var e=this.emitter.subscribe(t,n);this.unsubs.push(e)},n.prototype.destroy=function(){this.removeDOMListeners(),this.unsubs.forEach((function(t){return t()}))},n}(s),l=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),p=function(){return p=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},p.apply(this,arguments)},f=function(t){function e(n,e){return t.call(this,n,p({name:"Formula",listeners:["input","keydown"]},e))||this}return l(e,t),e.prototype.init=function(){var n=this;t.prototype.init.call(this),this.$formula=this.$root.find("#formula "),this.$on("table:typing",(function(t){n.$formula.text(t)})),this.$on("table:select",(function(t){n.$formula.text(t)}))},e.prototype.onInput=function(t){this.$emit("formula:typing",n(t.target).text())},e.prototype.toHTML=function(){return'\n      <div class="info">fx</div>\n      <div id="formula" class="input" contenteditable spellcheck="false"></div>\n    '},e.prototype.onKeydown=function(t){switch(t.key){case"Enter":case"Tab":t.preventDefault(),this.$emit("formula:done")}},e.className="excel__formula",e}(u),h=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),y=function(){return y=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},y.apply(this,arguments)},d=function(t){function n(n,e){return t.call(this,n,y({name:"Header",listeners:["input","click"]},e))||this}return h(n,t),n.prototype.onInput=function(){console.log(this)},n.prototype.onClick=function(){console.log(this)},n.prototype.toHTML=function(){return'\n      <input type="text" class="input" value="Новая таблица" />\n\n      <div>\n\n        <div class="button">\n          <i class="material-icons">delete</i>\n        </div>\n\n        <div class="button">\n          <i class="material-icons">exit_to_app</i>\n        </div>\n\n      </div>\n    '},n.className="excel__header",n}(u);function v(t,n){return'\n    <div class="column" data-type="resizable" data-col="'.concat(n,'">\n      ').concat(t,'\n      <div class="col-resize" data-resize="col"></div>\n    </div>\n  ')}function m(t){return function(n,e){return'<div class="cell" data-col="'.concat(e,'" data-id="').concat(t,":").concat(e,'" data-type="cell" contenteditable></div>')}}function g(t,n){var e=n?'<div class="row-resize"  data-resize="row"></div>':"";return'\n    <div class="row"  data-type="resizable">\n      <div class="row-info">\n        '.concat(n||"","\n        ").concat(e,'\n      </div>\n\n      <div class="row-data">').concat(t,"</div>\n    </div>\n  ")}function b(t,n){return String.fromCharCode(65+n)}var w=function(){function t(){this.group=[],this.current=null}return t.prototype.select=function(t){this.clear(),this.current=t,this.group.push(t),t.focus().addClass("selected")},t.prototype.clear=function(){this.group.forEach((function(n){return n.removeClass(t.className)})),this.group=[]},t.prototype.selectGroup=function(n){this.clear(),this.group=n,this.group.forEach((function(n){return n.addClass(t.className)}))},t.className="selected",t}(),_=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),$=function(){return $=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},$.apply(this,arguments)},O=function(t){function e(n,e){return t.call(this,n,$({name:"Table",listeners:["mousedown","keydown","input"]},e))||this}return _(e,t),e.prototype.onMousemove=function(){console.log("mousemove")},e.prototype.onMouseup=function(){console.log("mouseup")},e.prototype.toHTML=function(){return function(t){void 0===t&&(t=15);var n=[],e=new Array(26).fill("").map(b).map(v).join("");n.push(g(e));for(var o=0;o<t;o++){var r=new Array(26).fill("").map(m(o)).join("");n.push(g(r,(o+1).toString()))}return n.join("")}(20)},e.prototype.prepare=function(){this.selection=new w},e.prototype.init=function(){var n=this;t.prototype.init.call(this);var e=this.$root.find('[data-id="0:0"]');this.selectCell(e),this.$on("formula:typing",(function(t){n.selection.current.text(t)})),this.$on("formula:done",(function(){n.selection.current.focus()}))},e.prototype.selectCell=function(t){this.selection.select(t),this.$emit("table:select",t.text())},e.prototype.onMousedown=function(t){var e=this;if(t.target instanceof HTMLElement)if(t.target.dataset.resize)!function(t,e){var o;if(e.target instanceof HTMLElement){var r=n(e.target),i=e.target,s=r.closest('[data-type="resizable"]'),c=s.getCoords(),a=i.dataset.resize,u="col"===a?"bottom":"right",l="0px";r.css(((o={opacity:1})[u]="-2000px",o)),document.onmousemove=function(t){if("col"===a){var n=t.pageX-c.right;r.css({right:-n+"px"}),l=c.width+n+"px"}else n=t.pageY-c.bottom,r.css({bottom:-n+"px"}),l=c.height+n+"px"},document.onmouseup=function(){document.onmousemove=null,"col"===a?(s.css({width:l}),t.findAll('[data-col="'.concat(s.data.col,'"]')).forEach((function(t){return t.style.width=l})),r.css({opacity:0,bottom:"0px",right:"0px"})):(s.css({height:l}),r.css({opacity:0,bottom:"0px",right:"0px"}))}}}(this.$root,t);else if("cell"===t.target.dataset.type){var o=n(t.target);if(t.shiftKey){var i=function(t,n){var e=t.idCell(),o=n.idCell(),i=r(o.col,e.col),s=r(o.row,e.row);return i.reduce((function(t,n){return s.forEach((function(e){t.push("".concat(e,":").concat(n))})),t}),[])}(o,this.selection.current).map((function(t){return e.$root.find('[data-id="'.concat(t,'"]'))}));this.selection.selectGroup(i)}else this.selection.select(o),this.$emit("table:select",o.text())}},e.prototype.onInput=function(t){this.$emit("table:typing",t.target.textContent.trim())},e.prototype.onKeydown=function(t){var n=t.key;if(["Enter","Tab","ArrowLeft","ArrowRight","ArrowDown","ArrowUp"].includes(n)&&!t.shiftKey){t.preventDefault();var e=this.selection.current.idCell(),o=this.$root.find(function(t,n){var e=n.col,o=n.row;switch(t){case"Enter":case"ArrowDown":o++;break;case"Tab":case"ArrowRight":e++;break;case"ArrowLeft":e=e-1<0?0:e-1;break;case"ArrowUp":o=o-1<0?0:o-1}return'[data-id="'.concat(o,":").concat(e,'"]')}(n,e));this.selectCell(o)}},e.className="excel__table",e}(u),x=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),C=function(){return C=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},C.apply(this,arguments)},j=new o("#app",{components:[d,f,function(t){function n(n,e){return t.call(this,n,C({name:"Toolbar",listeners:["input","click"]},e))||this}return x(n,t),n.prototype.onInput=function(){console.log(this)},n.prototype.onClick=function(){console.log(this)},n.prototype.toHTML=function(){return'\n      <div class="button">\n        <i class="material-icons">format_align_left</i>\n      </div>\n\n      <div class="button">\n        <i class="material-icons">format_align_center</i>\n      </div>\n\n      <div class="button">\n        <i class="material-icons">format_align_right</i>\n      </div>\n\n      <div class="button">\n        <i class="material-icons">format_bold</i>\n      </div>\n\n      <div class="button">\n        <i class="material-icons">format_italic</i>\n      </div>\n\n      <div class="button">\n        <i class="material-icons">format_underlined</i>\n      </div>\n    '},n.className="excel__toolbar",n}(u),O]});j.render(),console.log("excel",j),console.log("Header",d)}();